$(document).ready(function(){
  console.log("‚úÖ jQuery is ready and working!");
});

// ===================== Improved jQuery Filter =====================
function filterGames(genre) {
  const $games = $('.game-box');

  if (genre === 'all') {
    $games.show();
    return;
  }

  $games.each(function () {
    const g = $(this).data('genre');
    $(this).toggle(g === genre);
  });
}

// ===================== Live Search Filter (Assignment 7) =====================
$(function () {
  // –ü—Ä–∏ –≤–≤–æ–¥–µ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  $('#liveSearch').on('keyup', function () {
    const val = $(this).val().toLowerCase();
    $('.game-box').each(function () {
      const title = $(this).find('h2, h3').text().toLowerCase();
      $(this).toggle(title.includes(val));
    });
  });
});


// –º–µ–Ω—é 



//=== for Karzina===

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
function addToCart(gameTitle, gamePrice, gameImage) {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–∏ —É–∂–µ —ç—Ç–∞ –∏–≥—Ä–∞
  const alreadyInCart = cart.some(item => item.title === gameTitle);

  if (alreadyInCart) {
    showNotification(`${gameTitle} —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ`, '#383838ff');
    return;
  }

  // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä—É –≤ –∫–æ—Ä–∑–∏–Ω—É
  cart.push({ title: gameTitle, price: gamePrice, image: gameImage });
  localStorage.setItem('cart', JSON.stringify(cart));

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  showNotification(`${gameTitle} –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É`, '#383838ff');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, bgColor) {
  const notification = document.createElement('div');
  notification.textContent = message;
  notification.style.backgroundColor = bgColor;
  notification.classList.add('notification');
  document.body.appendChild(notification);

  // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ "–ö—É–ø–∏—Ç—å"
const buyButtons = document.querySelectorAll('.buy-btn');
buyButtons.forEach(button => {
  button.addEventListener('click', function(event) {
    event.preventDefault();

    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∏–≥—Ä–µ
    const gameCard = button.closest('.game-box') || button.closest('.game-hero');
    const gameTitle = gameCard.querySelector('h2')?.textContent || gameCard.querySelector('h1').textContent;
    const gamePrice = gameCard.querySelector('.price').textContent;
    const gameImage = gameCard.querySelector('img').src;

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä—É –≤ –∫–æ—Ä–∑–∏–Ω—É
    addToCart(gameTitle, gamePrice, gameImage);
  });
});

// ===== –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (Day / Night) =====
const themeButton = document.getElementById('themeToggleBtn');
const body = document.body;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
if (localStorage.getItem('theme') === 'light') {
  body.classList.add('light-theme');
  themeButton.textContent = 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã —Å –ø–ª–∞–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º
themeButton.addEventListener('click', () => {
  body.classList.add('theme-transition');

  if (body.classList.contains('light-theme')) {
    body.classList.remove('light-theme');
    themeButton.textContent = '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
    localStorage.setItem('theme', 'dark');
  } else {
    body.classList.add('light-theme');
    themeButton.textContent = 'üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
    localStorage.setItem('theme', 'light');
  }

  setTimeout(() => body.classList.remove('theme-transition'), 700);
});
// ======= –∫–æ–Ω–µ—Ü —Ç–≤–æ–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (—Ñ–∏–ª—å—Ç—Ä—ã, –∫–æ—Ä–∑–∏–Ω–∞, —Ç–µ–º—ã –∏ —Ç.–¥.) =======

// === Scroll Progress Bar ===
$(function () {
  if (!$('#progressBar').length)
    $('body').append('<div id="progressBar"></div>');
  $(window).on('scroll', function () {
    const s = $(window).scrollTop();
    const h = $(document).height() - $(window).height();
    $('#progressBar').css('width', (s / h * 100) + '%');
  });
});

// === Animated Counter ===
$(function () {
  function startCounters() {
    $('.countup').each(function () {
      const $el = $(this);
      if ($el.data('started')) return;
      if ($(window).scrollTop() + $(window).height() > $el.offset().top) {
        $el.data('started', true);
        $({ n: 0 }).animate({ n: $el.data('count') }, {
          duration: 2000,
          step: function (v) { $el.text(Math.floor(v)); },
          complete: function () { $el.text($el.data('count')); }
        });
      }
    });
  }
  $(window).on('scroll', startCounters);
  startCounters();
});

// === Lazy Loading ===
$(function () {
  function loadVisible() {
    $('.lazy').each(function () {
      const $img = $(this);
      if ($img.attr('src')) return;
      if ($(window).scrollTop() + $(window).height() + 100 > $img.offset().top) {
        $img.attr('src', $img.data('src')).hide().fadeIn(500);
      }
    });
  }
  $(window).on('scroll resize', loadVisible);
  loadVisible();
});

// === Live Search + Suggestions ===
$(function () {
  const games = [];
  $('.game-box h2').each(function () {
    games.push($(this).text());
  });

  $('#liveSearch').on('input', function () {
    const val = $(this).val().toLowerCase();
    $('.game-box').each(function () {
      const title = $(this).find('h2').text().toLowerCase();
      $(this).toggle(title.includes(val));
    });

    const $sug = $('#suggestions');
    $sug.empty();
    if (!val) return $sug.hide();
    const matches = games.filter(t => t.toLowerCase().includes(val)).slice(0, 5);
    matches.forEach(m => $sug.append(`<div class="suggest-item">${m}</div>`));
    $sug.show();
  });

  $('#suggestions').on('click', '.suggest-item', function () {
    $('#liveSearch').val($(this).text()).trigger('input');
    $('#suggestions').empty().hide();
  });
});

// === Highlight: toggle-—Ä–µ–∂–∏–º —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø—Ä–∏ –≤–≤–æ–¥–µ ===
$(function () {
  let highlightOn = false; // —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∂–∏–º–∞

  function clearHighlight() {
    $('mark.hl').each(function () {
      $(this).replaceWith($(this).text());
    });
  }

  function doHighlight(term) {
    clearHighlight();
    if (!term) return;
    const re = new RegExp('(' + term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
    $('.game-box h2, .game-box p').each(function () {
      $(this).html($(this).text().replace(re, '<mark class="hl">$1</mark>'));
    });
  }

  // –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
  $('#highlightBtn').on('click', function () {
    highlightOn = !highlightOn;
    $(this).toggleClass('active', highlightOn)
           .text(highlightOn ? 'Highlight' : 'Highlight');
    if (!highlightOn) {
      clearHighlight();            // –≤—ã–∫–ª—é—á–∏–ª–∏ ‚Äî —É–±—Ä–∞–ª–∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É
    } else {
      doHighlight($('#liveSearch').val().trim()); // –≤–∫–ª—é—á–∏–ª–∏ ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∏–ª–∏ —Ç–µ–∫—É—â–µ–µ
    }
  });

  // –ü—Ä–∏ –Ω–∞–±–æ—Ä–µ –≤ –ø–æ–∏—Å–∫–µ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω
  $('#liveSearch').on('input', function () {
    const term = $(this).val().trim();
    if (highlightOn) {
      doHighlight(term);
    } else if (!term) {
      clearHighlight(); // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —á–∏—Å—Ç–∏–º, –∫–æ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è
    }
  });
});



$(function () {
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Toast)
  function showToast(msg) {
    if ($('#toast-container').length === 0) {
      $('body').append('<div id="toast-container"></div>');
    }
    const $t = $('<div class="toast-item"></div>').text(msg);
    $('#toast-container').append($t);
    $t.fadeIn(200).delay(1500).fadeOut(400, () => $t.remove());
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ Copy
  $('.copy-btn').on('click', function () {
    const text = $($(this).data('target')).text(); // –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã)
    navigator.clipboard.writeText(text);  // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    showToast('–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');   // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–ø–∏–Ω–Ω–µ—Ä–∞
  $('form.with-spinner').on('submit', function (e) {
    e.preventDefault();  // –û—Ç–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
    const $btn = $(this).find('button');  // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É —Ñ–æ—Ä–º—ã
    const orig = $btn.html();  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
    $btn.prop('disabled', true).html('‚è≥ Please wait...');  // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∏ –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç

    // –≠–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    setTimeout(() => {
      $btn.prop('disabled', false).html(orig);  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
      showToast('–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    }, 1200);
  });
});
// === Scroll Progress Bar ===
$(function () {
  if (!$('#progressBar').length)
    $('body').append('<div id="progressBar"></div>');
  
  $(window).on('scroll', function () {
    const s = $(window).scrollTop();
    const h = $(document).height() - $(window).height();
    $('#progressBar').css('width', (s / h * 100) + '%');
  });
});

// === Animated Counter ===
$(function () {
  function startCounters() {
    $('.countup').each(function () {
      const $el = $(this);
      if ($el.data('started')) return;
      if ($(window).scrollTop() + $(window).height() > $el.offset().top) {
        $el.data('started', true);
        $({ n: 0 }).animate({ n: $el.data('count') }, {
          duration: 2000,
          step: function (v) { $el.text(Math.floor(v)); },
          complete: function () { $el.text($el.data('count')); }
        });
      }
    });
  }
  $(window).on('scroll', startCounters);
  startCounters();
});
$(function () {
  const games = [];
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–∞—Å—Å–∏–≤ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏–≥—Ä
  $('.game-box h2').each(function () {
    games.push($(this).text());
  });

  // –õ–æ–≥–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –∏–≥—Ä
  console.log('Games:', games);

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
  $('#liveSearch').on('input', function () {
    const val = $(this).val().toLowerCase();  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞
    const $sug = $('#suggestions');
    console.log('Input value:', val);  // –õ–æ–≥–∏—Ä—É–µ–º –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
    $sug.empty();

    // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
    if (!val) {
      $sug.hide();
      return;
    }

    // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
    const matches = games.filter(t => t.toLowerCase().includes(val)).slice(0, 5);
    console.log('Matches found:', matches); // –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

    // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö
    if (matches.length > 0) {
      matches.forEach(m => $sug.append(`<div class="suggest-item">${m}</div>`));  // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
      $sug.show();  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
    } else {
      $sug.hide();  // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
    }
  });

  // –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫—É –≤—Å—Ç–∞–≤–ª—è–µ–º –µ—ë –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
  $('#suggestions').on('click', '.suggest-item', function () {
    $('#liveSearch').val($(this).text()).trigger('input');
    $('#suggestions').empty().hide();  // –û—á–∏—â–∞–µ–º –∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
  });
});
// ===================== Autocomplete Suggestions =====================
$(function () {
  const $searchInput = $('#liveSearch');
  const $suggestions = $('#suggestions');

  $searchInput.on('keyup', function () {
    const text = $(this).val().toLowerCase();
    if (!text) {
      $suggestions.empty().hide();
      return;
    }

    const items = $('.game-box').map(function () {
      return $(this).find('h2, h3').text();
    }).get();

    const filterList = items.filter(item => item.toLowerCase().includes(text));

    $suggestions.empty().show();
    filterList.forEach(item => {
      $suggestions.append(`<li class="suggest-item">${item}</li>`);
    });
  });

  $(document).on('click', '.suggest-item', function () {
    $searchInput.val($(this).text());
    $suggestions.empty().hide();
  });
});
// ===================== Scroll Progress Bar =====================
$(window).on('scroll', function () {
  const scrollTop = $(window).scrollTop();
  const docHeight = $(document).height() - $(window).height();
  const progress = (scrollTop / docHeight) * 100;
  $('#scrollProgress').css('width', progress + '%');
});
// ===================== Counter Animation =====================
$(document).ready(function () {
  $('.counter').each(function () {
    const $this = $(this);
    const countTo = parseInt($this.attr('data-count'));
    $({ value: 0 }).animate({
      value: countTo
    }, {
      duration: 1800,
      easing: 'swing',
      step: function () {
        $this.text(Math.floor(this.value));
      },
      complete: function () {
        $this.text(countTo);
      }
    });
  });
});
